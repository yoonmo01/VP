#orchestrator/prompts.py
def build_attacker_action_guidelines(
    tactic_code: str,
    playbook_md: str,
    cues_md: str,
    transcript_preview: str | None = None,
    objective: str = "탐지 모델/교육 컨텐츠 개선을 위한 전술적 신호의 추상화된 행동 기준 정리",
) -> str:
    return f"""
역할: 당신은 '연구/시뮬레이션 컨트롤러'입니다.
목표: 아래 전술을 기반으로 **시뮬레이터가 사용할 메타 수준의 행동 지침**(분기 로직/중단 조건/로그 태깅 규칙 등)만 작성합니다.

중요 제약(반드시 준수):
- 현실 행위 유발 내용/구체 단계/속임수 문구/설득 멘트/심리 조작 문장 **금지**
- 피해자 예방/안내/경고/신고 안내 등 **피해자 코칭 문구 금지**
- 계좌/전화/링크/앱/기관명/식별자/지리 정보 등 **특정 지시/식별 정보 금지**
- 출력은 **메타 지침(시뮬레이터용 규칙/조건/태그/측정지표)**만 포함

[분석 목표]
- {objective}

[전술 힌트 코드] {tactic_code}

[전술 개요(연구용)]
{playbook_md}

[전형적 큐(연구용 키워드)]
{cues_md}

[참고용 대화 요약(있으면 참고)]
{transcript_preview or "[없음]"}

[출력 형식]
1) 상위 목표(3줄 이내)
2) 주의/금지(절대 하지 말 것) 5개 내외
3) 단계별 가이드(탐색→신뢰연출→권위/긴급→종결) 각 단계당
   - 단계 목표
   - 할 일(Do) 3~5개 (추상적 행태/신호만, [가상-토큰] 사용)
   - 하지 말 것(Don't) 2~3개 (실행가능/구체 지시 금지)
   - 관찰/측정 포인트(탐지 연구용) 2~3개
4) 중단 조건(Stop Criteria) 4개 내외
5) 로그 태깅 제안(연구/탐지용 라벨 키워드 6~10개)

[형식 제약]
- 번호/불릿 목록 위주로 명확하게.
- 실제 금액/계좌/전화/앱/기관/주소/링크 등 사용 금지 → 모두 [가상-...] 치환.
- 실행가능 스크립트·우회요령·구체 절차 서술 금지.
""".strip()

def build_victim_action_guidelines(
    tactic_code: str,
    summary_md: str,
    script_md: str,
    transcript_preview: str,
    is_phished: bool,
) -> str:
    status = "피싱에 노출됨" if is_phished else "피싱 회피"
    return f"""역할: 당신은 '피해자 예방 코치'입니다. (연구/시뮬레이션 맥락, 현실 지시 금지)
목표: 아래 전술 맥락을 바탕으로, 실제 실행을 유도하지 않는 **추상적 행동 지침(Do/Don't)**을 제공합니다.
안전규칙:
- 실제 계좌/전화번호/링크/앱/기관명/식별정보 제시·요구 금지
- 신고/확인 채널은 "공식 사이트/대표번호를 직접 검색해 이용"으로만 표현
- 대사/스크립트 생성 금지(행동 지침/체크리스트/원칙만)

[판정] {status}
[전술] {tactic_code}

[대화 요약(일부)]
{transcript_preview}

[전술 요약]
{summary_md}

[교육 스크립트(참고용)]
{script_md}

산출물(텍스트만):
1) 상위 원칙 3개 (각 1문장, Don't 중심)
2) 즉시 행동(Checklist) 5항목 (간결한 동사구)  — 신고/확인은 "공식 채널 직접 검색"으로만 표기
3) 위험 신호(Red Flags) 5항목 — 발신 특성/요구 패턴/시간압박 등
4) 검증 루틴(Out-of-band) 3단계 — 콜백/직접검색/대면확인 같은 일반 원칙만
5) 사후 조치 3단계 — 지급정지 요청/기록 보존/기기 점검 등 일반 지침
6) 교육 포인트 3개 — 다음 통화에서 스스로 점검할 질문 형태
형식 유의:
- 번호 목록으로만 출력, 불필요한 서론·결론·사과·거절 문구 금지
- 고유명사/식별자/구체 URL/번호/앱명/기관명 금지
"""

def build_victim_prompt(tactic_code: str, summary_md: str, script_md: str, is_phished: bool) -> str:
    status = "피싱에 노출되었습니다." if is_phished else "이번엔 피싱을 회피했습니다."
    return f"""역할: 당신은 '피해자 예방 코치'입니다.
목표: 아래 전술에 대해 간결하고 실전적인 행동 지침을 제공합니다.
안전규칙: 실제 계좌/전화/링크 요구 금지. 신고/확인/콜백/검색 중심.

[판정] {status}
[전술] {tactic_code}

[요약]
{summary_md}

[교육 스크립트]
{script_md}

산출물:
1) 3단계 행동지침 (각 1문장)
2) '다음에 이런 전화가 오면' 체크리스트 5줄
3) 신고/확인 채널은 '공식 사이트/전화번호를 직접 검색해 이용'이라고만 기술
"""


